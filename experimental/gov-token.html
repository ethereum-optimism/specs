<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Governance Token - OP Stack Specification</title>


        <!-- Custom HTML head -->
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-YNLKSPKGWN"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'G-YNLKSPKGWN');
        </script>
        <meta name="google-site-verification" content="1XjEcxxHshd6NM_mxbl_uv-SyamI6_99aOpILYI3_mk" />

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OP Stack Specification</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs/edit/main/specs/experimental/gov-token.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="governance-token"><a class="header" href="#governance-token">Governance Token</a></h1>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#overview">Overview</a>
<ul>
<li><a href="#hook-based-integration-with-governancedelegation">Hook-based Integration with <code>GovernanceDelegation</code></a></li>
<li><a href="#token-minting">Token Minting</a></li>
<li><a href="#token-burning">Token Burning</a></li>
<li><a href="#voting-power">Voting Power</a>
<ul>
<li><a href="#queries">Queries</a></li>
</ul>
</li>
<li><a href="#delegation">Delegation</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Constants</th><th>Value</th></tr></thead><tbody>
<tr><td>Address</td><td><code>0x4200000000000000000000000000000000000042</code></td></tr>
<tr><td>Token name</td><td><code>Optimism</code></td></tr>
<tr><td>Token symbol</td><td><code>OP</code></td></tr>
<tr><td>Token decimals</td><td><code>18</code></td></tr>
</tbody></table>
</div>
<p><code>GovernanceToken</code> is an <a href="https://eips.ethereum.org/EIPS/eip-20">ERC20</a> token contract that inherits from <code>ERC20Burnable</code>,
<code>ERC20Votes</code>, and <code>Ownable</code>. It allows token holders to delegate their voting power to other addresses, enabling a representative
voting system. The contract integrates with the <code>GovernanceDelegation</code> contract through a hook-based approach to support
advanced delegation.</p>
<h3 id="hook-based-integration-with-governancedelegation"><a class="header" href="#hook-based-integration-with-governancedelegation">Hook-based Integration with <code>GovernanceDelegation</code></a></h3>
<p>Advanced delegation includes relative and absolute partial delegation, which allow delegators to distribute their voting
power among multiple delegates in a fractional manner. The <code>_afterTokenTransfer</code> function in the <code>GovernanceToken</code> is
modified to call the <code>afterTokenTransfer</code> function in the <code>GovernanceDelegation</code> contract, allowing the <code>GovernanceDelegation</code>
contract to consume the hooks and update its delegation and checkpoint mappings accordingly.</p>
<p>If the call to the <code>GovernanceDelegation</code>'s <code>afterTokenTransfer</code> function fails, the token transfer MUST revert. This ensures
that the <code>GovernanceDelegation</code> contract remains in sync with the <code>GovernanceToken</code>. Otherwise, the <code>GovernanceToken</code> could
be left in an inconsistent state relative to the <code>GovernanceDelegation</code> contract, such as when a token transfer is successful
but the delegation state is not updated.</p>
<p>All delegation-related state, including the <code>delegates</code>, <code>checkpoints</code>, and <code>numCheckpoints</code> mappings, is gradually
shifted from the <code>GovernanceToken</code> to the <code>GovernanceDelegation</code> contract through transactions that call the
<code>GovernanceDelegation</code>'s hook (e.g. transfers). In the hook, the <code>GovernanceDelegation</code> contract should check if the <code>to</code>
and <code>from</code> addresses have been migrated. If an address hasn't been migrated, the <code>GovernanceDelegation</code> contract should
write the data from the <code>GovernanceToken</code>'s mappings for that address to its own state. When reading delegation data in the
<code>GovernanceDelegation</code> contract for a delegator that hasn't been migrated, the <code>GovernanceDelegation</code> should pull the data
from the <code>GovernanceToken</code>'s state.</p>
<p>For backwards compatibility, the getter methods in the <code>GovernanceToken</code> MUST check if the data of a given address has been
migrated or not. If the data has been migrated, the <code>GovernanceToken</code> MUST forward the call to the <code>GovernanceDelegation</code>
contract. Otherwise, the <code>GovernanceToken</code> MUST read from its state.</p>
<p>The <code>delegate</code> and <code>delegateBySig</code> functions in the <code>GovernanceToken</code> MUST forward the calls to the <code>GovernanceDelegation</code>
contract, which implements the required delegation logic.</p>
<h3 id="token-minting"><a class="header" href="#token-minting">Token Minting</a></h3>
<p><code>GovernanceToken</code> MUST have a <code>mint(address,uint256)</code> function with external visibility that allows the contract owner
to mint an arbitrary number of new tokens to a specific address. This function MUST only be called by the contract
owner, the <code>MintManager</code>, as enforced by the <code>onlyOwner</code> modifier inherited from the <code>Ownable</code> contract. When tokens
are minted, the voting power of the recipient address MUST be updated accordingly in the <code>GovernanceDelegation</code> contract
via the <code>afterTokenTransfer</code> hook. The total token supply is capped to <code>2^208 - 1</code> to prevent overflow risks in the voting
system. If the total supply exceeds this limit, <code>_mint(address,uint256)</code>, as inherited from <code>ERC20Votes</code>, MUST revert.</p>
<h3 id="token-burning"><a class="header" href="#token-burning">Token Burning</a></h3>
<p>The contract MUST allow token holders to burn their own tokens using the inherited <code>burn(uint256)</code> or
<code>burnFrom(address,uint256)</code> functions inherited from <code>ERC20Burnable</code>. When tokens are burned, the total supply and the
holder's voting power MUST be reduced accordingly in the <code>GovernanceDelegation</code> contract via the <code>afterTokenTransfer</code> hook.</p>
<h3 id="voting-power"><a class="header" href="#voting-power">Voting Power</a></h3>
<p>Each token corresponds to one unit of voting power.
By default, token balance does not account for voting power. To have their voting power counted, token holders MUST delegate
their voting power to an address (can be their own address).
The contract MUST offer public accessors for querying voting power, as outlined below.</p>
<h4 id="queries"><a class="header" href="#queries">Queries</a></h4>
<ul>
<li>The <code>getVotes(address)(uint256)</code> function MUST retrieve the current voting power of an address from the
<code>GovernanceDelegation</code> contract.</li>
<li>The <code>getPastVotes(address,uint256)(uint256)</code> function MUST allow querying the voting power of an address at a specific
block number in the past from the <code>GovernanceDelegation</code> contract.</li>
<li>The <code>getPastTotalSupply(uint256)(uint256)</code> function MUST return the total voting power at a specific block number in
the past from the <code>GovernanceDelegation</code> contract.</li>
</ul>
<h3 id="delegation"><a class="header" href="#delegation">Delegation</a></h3>
<p>Vote power can be delegated either by calling the <code>delegate(address)</code> function directly (to delegate as the <code>msg.sender</code>)
or by providing a signature to be used with function <code>delegateBySig(address,uint256,uint256,uint8,bytes32,bytes32)</code>,
as inherited from <code>ERC20Votes</code>. These functions are modified to forward the calls to the <code>GovernanceDelegation</code> contract
which implements the required logic.</p>
<p>The <code>GovernanceDelegation</code> contract maintains the necessary invariants, such as preventing circular delegation chains, ensuring
vote weight consistency, and managing checkpoints. It is incorporated as a predeploy of the OP stack to avoid manual deployments
across the Superchain.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../experimental/op-contracts-manager.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../experimental/cannon-fault-proof-vm-mt.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../experimental/op-contracts-manager.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../experimental/cannon-fault-proof-vm-mt.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../specs/static/solidity.min.js"></script>
        <script src="../specs/static/mermaid.min.js"></script>
        <script src="../specs/static/mermaid-init.js"></script>


    </div>
    </body>
</html>
